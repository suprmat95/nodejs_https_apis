# pryv_exercise_3
## Dependencies
1. Install Node.js and npm:
    ```bash
    $ curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash - && sudo apt install -y nodejs
    ```
2. Install MongoDB, following this link [MongoDB](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/#install-mongodb-community-edition-using-deb-packages)    
3. Install [`project`]'s dependencies, in the project folder type:
    ```bash
    $ npm i -s
    ```

## Launch the Server 
1. Start MongoDB:
    ```bash
    $ sudo service mongod start    
    ```
2. Optionally, free the  server port which is set to 3000 by default:
    ```bash
    $ lsof -i tcp:3000 | grep LISTEN | awk '{print $2}' | xargs kill
    ```
3. Run the server:
    ```bash
    $ chmod u+x server.sh
    $ ./server.sh
    ```
4. Optionally, it's possible to chose a port with the command:
    ```bash
    $ PORT = typeyourport ./server.sh
    ```
   
## APIs
Following a brief explanation of the available APIs which can be tested simply using software like postman. The body must be written in JSON format.
1. Users APIs:
    1.  **POST** to create a new users: 
        ```bash
           localhost:3000/users 
        ```
        **Body:**
        ```bash
           {"name": "name","password" : "password"} 
        ```
        **Result:**
        1. `200` OK
        2. `400` Request failed! Please check the request
        3. `403` The name is already present in the db
2. Login APIs:
    1.  **GET** to login and to get a valid Token:
        ```bash
           localhost:3000/auth/login 
        ```
        **Body:**
        ```bash
           {"name": "name","password" : "password"} 
        ```
        **Result:**
        1. `200` OK
        2. `400` Authentication failed! Please check the request format
        3. `403` Username not present in db or Password doesn t match! Please check the request
3. Resource APIs:

    All APIs need authentication, after logging, copy the token obtained in the Bearer Token field.
    1.  **POST** to create a new resource: 
        ```bash
           localhost:3000/auth/resource 
        ```
        **Body:**
        ```bash
           {"id": "idResource", "data": [{"field1": "example"}]}
        ```
        The data field is the only one required. Within the data field, up to 10 fields with the name from field1 to fiel10 can be specified. If the id field is not present in the request body will be generated by the server.
        
        **Result:**
        1. `200` OK
        2. `400` Resource data  can not be empty
        3. `500` Some error occurred while creating the Resource
    2.  **GET** to obtain all resources: 
        ```bash
           localhost:3000/auth/resource 
        ```
        **Result:**
        1. `200` OK
        2. `500` Some error occurred while finding the Resources
    3.  **GET** to obtain one resources. 
        ```bash
           localhost:3000/auth/resource/idResource
        ```
        **Result:**
        1. `200` OK
        2. `500` Error retrieving resource with id 
        3. `404` Resource not found with id 
    4.  **PUT** to update one resources: 
        ```bash
           localhost:3000/auth/resource/idResource
        ```
        **Body:**
        ```bash
           {"data": [{"field1": "newValue"}]}
        ```
        A resource that has been previously deleted cannot be updated.
        **Result:**
        1. `200` OK
        2. `500` Error updating resource with id 
        3. `404` Resource not found with id or already deleted
        4. `400` Resource data can not be empty
    5.  **DELETE** to delete one resources: 
        ```bash
           localhost:3000/auth/resource/idResource
        ```
        **Result:**
        1. `200` OK
        2. `500` Error deleting resource with id 
        3. `404` Resource not found with id or already deleted
  
## Launch the Tests 
1. Run the tests:
    ```bash
    $ npm run test
    ```


